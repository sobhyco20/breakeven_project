{% extends "base_reports.html" %}

{% block title %}{% load numfmt %}
تقرير تجميعي لاستهلاك المواد الخام{% endblock %}

{% block filters %}
<form method="get" class="row g-2 mb-3">
  <div class="col-md-4">
    <label class="form-label">الفترة</label>
    <select name="period" class="form-select">
      {% for p in periods %}
        <option value="{{ p.id }}"
          {% if current_period and p.id == current_period.id %}selected{% endif %}>
          {{ p.name }} ({{ p.start_date }} - {{ p.end_date }})
        </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2 align-self-end">
    <button type="submit" class="btn btn-primary w-100">عرض</button>
  </div>
</form>
{% endblock %}

{% block content %}
<table class="table table-striped table-bordered table-sm">
  <thead class="table-secondary">
    <tr>
      <th>#</th>
      <th>مادة خام</th>
      <th>الكود</th>
      <th>إجمالي الكمية المستهلكة</th>
      <th>الوحدة</th>
      <th>إجمالي التكلفة</th>
    </tr>
  </thead>
  <tbody>
    {% for row in rows %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ row.raw_material__name }}</td>
        <td>{{ row.raw_material__sku }}</td>
        <td>{{ row.total_qty|num:3 }}</td>
        <td>{{ row.raw_material__ingredient_unit__name }}</td>
        <td>{{ row.total_cost|num:3 }}</td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="5" class="text-center">لا توجد بيانات في الفترة المحددة.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
