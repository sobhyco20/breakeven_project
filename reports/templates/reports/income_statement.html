{% load humanize %}
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>{{ title|default:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„" }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{background:#f6f7fb}
    .page-wrap{min-height:100vh}
    .sidebar{
      background:#fff;border:1px solid #e7e7ee;border-radius:14px;
      height: calc(100vh - 24px);
      position: sticky; top: 12px;
      overflow:auto;
    }
    .period-btn{
      border-radius:10px;
      padding:.55rem .7rem;
      display:flex; justify-content:space-between; align-items:center;
      font-size:.95rem;
    }
    .period-btn small{opacity:.75}
    .card-kpi{border-radius:16px;border:1px solid #e7e7ee}
    .kpi-title{font-size:.8rem; color:#6b7280}
    .kpi-value{font-size:1.35rem; font-weight:800}
    .table-wrap{background:#fff;border:1px solid #e7e7ee;border-radius:16px}
    .table td, .table th{vertical-align:middle}
    justify-content:center;   /* â¬…ï¸ ØªÙˆØ³ÙŠØ· Ø£ÙÙ‚ÙŠ */
    align-items:center;       /* â¬…ï¸ ØªÙˆØ³ÙŠØ· Ø¹Ù…ÙˆØ¯ÙŠ */
    .row-total{background:#eaf7ef !important; font-weight:800}
    .mono{font-variant-numeric: tabular-nums;}
  </style>
</head>

<body>
<div class="container-fluid px-3 py-3 page-wrap">
  <div class="row g-3">

    <!-- ===== Sidebar: Ø§Ù„ÙØªØ±Ø§Øª ÙƒØ£Ø²Ø±Ø§Ø± ===== -->
    <div class="col-12 col-lg-3 col-xl-2">
      <div class="sidebar p-3">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="fw-bold">ğŸ—“ï¸ Ø§Ù„ÙØªØ±Ø§Øª</div>
          <a class="btn btn-sm btn-outline-secondary"
             href="?">Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</a>
        </div>

        <div class="d-grid gap-2">
          {% for p in periods %}
            <a class="btn {% if current_period and p.id == current_period.id %}btn-primary{% else %}btn-outline-primary{% endif %} period-btn"
               href="?period={{ p.id }}">
              <span class="fw-bold">>{{ p }}</span>
            </a>
          {% empty %}
            <div class="text-muted small">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØªØ±Ø§Øª Ù…Ø³Ø¬Ù„Ø©.</div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- ===== Main ===== -->
    <div class="col-12 col-lg-9 col-xl-10">

      <!-- Ø¹Ù†ÙˆØ§Ù† + Ø§Ù„ÙØªØ±Ø© -->
      <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center mb-3">
        <div>
          <h4 class="m-0">{{ title|default:"Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„" }}</h4>
          <div class="text-muted small">
            {% if current_period %}Ø§Ù„ÙØªØ±Ø©: <b>{{ current_period }}</b>{% else %}Ø§Ø®ØªØ± ÙØªØ±Ø©{% endif %}
          </div>
        </div>
      </div>

      <!-- ===== KPI Cards ===== -->
      <div class="row g-3 mb-3">
        <div class="col-12 col-md-3">
          <div class="card card-kpi"><div class="card-body">
            <div class="kpi-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Revenue)</div>
            <div class="kpi-value mono">{{ revenue|floatformat:2|intcomma }}</div>
          </div></div>
        </div>

        <div class="col-12 col-md-3">
          <div class="card card-kpi"><div class="card-body">
            <div class="kpi-title">ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø§Ù… (COGS)</div>
            <div class="kpi-value mono">{{ cogs|floatformat:2|intcomma }}</div>
          </div></div>
        </div>

        <div class="col-12 col-md-3">
          <div class="card card-kpi"><div class="card-body">
            <div class="kpi-title">Ù…Ø¬Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­ (Gross Profit)</div>
            <div class="kpi-value mono">{{ gross_profit|floatformat:2|intcomma }}</div>
          </div></div>
        </div>

        <div class="col-12 col-md-3">
          <div class="card card-kpi border-2"><div class="card-body">
            <div class="kpi-title">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</div>
            <div class="kpi-value mono">{{ net_profit|floatformat:2|intcomma }}</div>
          </div></div>
        </div>
      </div>

      <!-- Ù…ØµØ±ÙˆÙØ§Øª OP/SA/AD + Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ -->
      <div class="row g-3 mb-3">
        <div class="col-12 col-md-3">
          <div class="card card-kpi"><div class="card-body">
            <div class="kpi-title">Ù…ØµØ±ÙˆÙØ§Øª ØªØ´ØºÙŠÙ„ÙŠØ© (OP)</div>
            <div class="kpi-value mono">{{ op|floatformat:2|intcomma }}</div>
          </div></div>
        </div>
        <div class="col-12 col-md-3">
          <div class="card card-kpi"><div class="card-body">
            <div class="kpi-title">Ù…ØµØ±ÙˆÙØ§Øª Ø¨ÙŠØ¹ÙŠØ© (SA)</div>
            <div class="kpi-value mono">{{ sa|floatformat:2|intcomma }}</div>
          </div></div>
        </div>
        <div class="col-12 col-md-3">
          <div class="card card-kpi"><div class="card-body">
            <div class="kpi-title">Ù…ØµØ±ÙˆÙØ§Øª Ø¥Ø¯Ø§Ø±ÙŠØ© (AD)</div>
            <div class="kpi-value mono">{{ ad|floatformat:2|intcomma }}</div>
          </div></div>
        </div>
        <div class="col-12 col-md-3">
          <div class="card card-kpi"><div class="card-body">
            <div class="kpi-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</div>
            <div class="kpi-value mono">{{ total_expenses|floatformat:2|intcomma }}</div>
          </div></div>
        </div>
      </div>

      <!-- ===== Ø¬Ø¯ÙˆÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø®Ù„ ===== -->
      <div class="table-wrap p-2">
        <div class="table-responsive">
          <table class="table table-bordered mb-0">
            <tbody class="mono">
              <tr>
                <th style="width:55%">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Revenue)</th>
                <td class="text-end">{{ revenue|floatformat:2|intcomma }}</td>
              </tr>
              <tr>
                <th>ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø§Ù… Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (COGS)</th>
                <td class="text-end">{{ cogs|floatformat:2|intcomma }}</td>
              </tr>
              <tr class="table-light">
                <th>Ù…Ø¬Ù…Ù„ Ø§Ù„Ø±Ø¨Ø­ (Gross Profit)</th>
                <td class="text-end fw-bold">{{ gross_profit|floatformat:2|intcomma }}</td>
              </tr>

              <tr>
                <th>Ù…ØµØ±ÙˆÙØ§Øª ØªØ´ØºÙŠÙ„ÙŠØ© (OP)</th>
                <td class="text-end">{{ op|floatformat:2|intcomma }}</td>
              </tr>
              <tr>
                <th>Ù…ØµØ±ÙˆÙØ§Øª Ø¨ÙŠØ¹ÙŠØ© (SA)</th>
                <td class="text-end">{{ sa|floatformat:2|intcomma }}</td>
              </tr>
              <tr>
                <th>Ù…ØµØ±ÙˆÙØ§Øª Ø¥Ø¯Ø§Ø±ÙŠØ© (AD)</th>
                <td class="text-end">{{ ad|floatformat:2|intcomma }}</td>
              </tr>
              <tr class="table-light">
                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</th>
                <td class="text-end fw-bold">{{ total_expenses|floatformat:2|intcomma }}</td>
              </tr>

              <tr class="row-total">
                <th>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</th>
                <td class="text-end">{{ net_profit|floatformat:2|intcomma }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</div>
</body>
</html>
