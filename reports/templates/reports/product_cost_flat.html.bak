{% extends "base_reports.html" %}

{% block title %}ØªÙ‚Ø±ÙŠØ± ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ (ØªØ¬Ù…ÙŠØ¹ÙŠ Ø¨Ø§Ù„ÙˆØ­Ø¯Ø§Øª){% endblock %}

{% block filters %}
<form method="get" class="row g-2 mb-3">

  <div class="col-md-3">
    <label class="form-label">Ø§Ù„ÙØªØ±Ø©</label>
    <select name="period" class="form-select">
      {% for p in periods %}
        <option value="{{ p.id }}"
          {% if current_period and p.id == current_period.id %}selected{% endif %}>
          {{ p.name }} ({{ p.start_date }} - {{ p.end_date }})
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-5">
    <label class="form-label">Ø§Ù„Ù…Ù†ØªØ¬</label>
    <select name="product" class="form-select">
      <option value="">-- Ø§Ø®ØªØ± Ù…Ù†ØªØ¬Ø§Ù‹ --</option>
      {% for pr in products %}
        <option value="{{ pr.id }}"
          {% if selected_product and pr.id == selected_product.id %}selected{% endif %}>
          {{ pr.code }} - {{ pr.name }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-2">
    <label class="form-label">Ø§Ù„ÙƒÙ…ÙŠØ©</label>
    <input type="number" step="0.001" name="qty"
           value="{{ qty }}" class="form-control">
  </div>

  <div class="col-md-2 align-self-end">
    <button type="submit" class="btn btn-primary w-100">
      Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    </button>
  </div>

</form>
{% endblock %}

{% block content %}

{% if selected_product and current_period and components %}

  <div class="text-center my-3">
    <h1 style="
        font-size: 32px;
        font-weight: 800;
        color: #0d6efd;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
    ">
      {{ selected_product.code }} - {{ selected_product.name }}
    </h1>
    <div class="mt-1">
      <strong>Ø§Ù„ÙØªØ±Ø©:</strong>
      {{ current_period.name }} ({{ current_period.start_date }} - {{ current_period.end_date }})
      &nbsp; | &nbsp;
      <strong>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø­Ø³Ø§Ø¨ ØªÙƒÙ„ÙØªÙ‡Ø§:</strong>
      {{ qty|floatformat:3 }}
    </div>
  </div>

  <div class="card mb-4 shadow-sm">
    <div class="card-body p-2">

      <h5 class="mt-1 mb-2">
        ğŸ“¦ Ù…ÙƒÙˆÙ‘Ù†Ø§Øª Ø§Ù„ÙˆØµÙØ© (Ù…ÙˆØ§Ø¯ Ø®Ø§Ù… + Ù…Ù†ØªØ¬Ø§Øª Ù…ØµÙ†Ù‘Ø¹Ø© + Ø§Ù„Ù…Ù†ØªØ¬ Ù†ÙØ³Ù‡)
      </h5>

      <table class="table table-bordered table-striped table-sm align-middle mb-3">
        <thead class="table-secondary text-center">
          <tr>
            <th style="width: 110px;">Ø§Ù„Ù†ÙˆØ¹</th>
            <th style="width: 110px;">Ø§Ù„ÙƒÙˆØ¯</th>
            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</th>
            <th style="width: 150px;">ØªÙƒÙ„ÙØ© Ø§Ù„Ù…Ø§Ø¯Ø© Ø¨Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©</th>
            <th style="width: 130px;">ÙˆØ­Ø¯Ø© Ø§Ù„Ù‚ÙŠØ§Ø³ Ø§Ù„ÙƒØ¨ÙŠØ±Ø©</th>
            <th style="width: 160px;">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„ÙˆØµÙØ©</th>
            <th style="width: 130px;">Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„ØµØºÙŠØ±Ø©</th>
            <th style="width: 150px;">Ø§Ù„ØªÙƒÙ„ÙØ©</th>
          </tr>
        </thead>
        <tbody>
          {% for row in components %}
            <tr
              class="
                {% if row.type == 'raw' %}
                  table-success
                {% elif row.type == 'manufactured' %}
                  table-warning
                {% elif row.type == 'product' %}
                  table-info
                {% endif %}
              "
            >
              <td class="text-center">
                {% if row.type == "raw" %}
                  <span class="badge bg-success">Ù…Ø§Ø¯Ø© Ø®Ø§Ù…</span>
                {% elif row.type == "manufactured" %}
                  <span class="badge bg-warning text-dark">Ù…Ù†ØªØ¬ Ù…ØµÙ†Ù‘ÙØ¹</span>
                {% elif row.type == "product" %}
                  <span class="badge bg-info text-dark">Ø§Ù„Ù…Ù†ØªØ¬ Ù†ÙØ³Ù‡</span>
                {% endif %}
              </td>

              <td class="text-center">
                {{ row.code }}
              </td>

              <td>
                {{ row.name }}
              </td>

              <td class="text-end">
                {% if row.big_unit_cost %}
                  {{ row.big_unit_cost|floatformat:3 }}
                {% else %}
                  -
                {% endif %}
              </td>

              <td class="text-center">
                {{ row.big_unit_name }}
              </td>

              <td class="text-end">
                {% if row.recipe_qty %}
                  {{ row.recipe_qty|floatformat:3 }}
                {% else %}
                  -
                {% endif %}
              </td>

              <td class="text-center">
                {{ row.small_unit_name }}
              </td>

              <td class="text-end">
                {% if row.total_cost %}
                  {{ row.total_cost|floatformat:3 }}
                {% else %}
                  -
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="8" class="text-center">
                Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙƒÙˆÙ‘Ù†Ø§Øª Ù…Ø³Ø¬Ù‘Ù„Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙˆØµÙØ©.
              </td>
            </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr class="table-info fw-bold">
            <td colspan="7" class="text-end">
              Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙƒÙ„ÙØ© Ø§Ù„ÙˆØµÙØ© Ù„Ù„ÙƒÙ…ÙŠØ© {{ qty|floatformat:3 }} Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬:
            </td>
            <td class="text-end">
              {{ total_cost|floatformat:3 }}
            </td>
          </tr>
        </tfoot>
      </table>

    </div>
  </div>

{% else %}
  <div class="alert alert-info text-center">
    Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø© ÙˆØ§Ù„Ù…Ù†ØªØ¬ Ø«Ù… Ø§Ø¶ØºØ· "Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±".
  </div>
{% endif %}

{% endblock %}
